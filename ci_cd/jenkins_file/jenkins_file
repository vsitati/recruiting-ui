pipeline {
   agent {
        node {
            label 'RecruitingQA'
        }
    }
    options {
        skipDefaultCheckout(true)
    }

   stages {
      stage('Teardown Environment') {
         steps {
          echo "Teardown Environment(WIP)"
         }
      }
      stage('Clean workspace and clone repository') {
         steps {
            // Clean before running the test
            cleanWs()
            checkout scm
         }
      }
      stage('Setup Virtual Environment') {
         steps {
          bat """
              python -m venv .env
              .\\.env\\Scripts\\activate.bat && python -m pip install -r requirements.txt
          """
         }
      }
      stage('Create Customer') {
         steps {
          echo "Create Customer(WIP)"
         }
      }
      stage('Smoke Tests') {
         steps {
          bat """
              .\\.env\\Scripts\\activate.bat && pytest -m smoke
          """
         }
      }
      stage('Full Regression Tests') {
         steps {
          bat """
              .\\.env\\Scripts\\activate.bat && pytest -k c758
          """
         }
      }
   }
}

